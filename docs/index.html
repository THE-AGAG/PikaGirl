<!DOCTYPE html>
<html lang="fr">
<!--
  FILE: index.html
  GROUP: Presentation / Static UI

  Notes:
  - Ce fichier contient la structure HTML et les contrÃ´les visibles.
  - SAFE TO EDIT: labels, text, order of controls, add/remove buttons, options in <select> (themeSelect, soundTypeSelect),
    paths to images/audio only if you keep the same relative layout (ex: 'img/...' and 'song/...').
  - CAUTION: Ne pas renommer les ids utilisÃ©s par `script.js` (ex: startBtn, clicker, gameImage, volumeSlider, soundVolumeSlider,
    musicToggle, soundToggle, saveNowBtn, exportBtn, importBtn, resetScoresBtn, backupBtn, backBtn, pseudo, music, clickSound, critSound,
    achievementSound). Si vous changez un id, mettez Ã  jour `script.js` en consÃ©quence.
-->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Clicker Pikagirl</title>
  <!-- Ensure relative paths work correctly when served from a subpath (GitHub Pages) -->
  <base href="./">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>ğŸ¯ Le Clicker du Groupe Pikagirl</h1>

<div class="controls"> <!-- Interrupteur pour la musique --> 
  <label class="toggle-switch"> 
    <input type="checkbox" id="musicToggle" /> 
    <span class="slider"></span> 
    <span>Musique</span> 
  </label>
    
      <!-- Curseur pour le volume global -->
<label class="volume">
  <input type="range" id="volumeSlider" min="0" max="100" value="50" />
</label>
    
      <!-- Interrupteur pour les sons -->
  <label class="toggle-switch">
    <input type="checkbox" id="soundToggle" />
    <span class="slider"></span>
    <span>Sons</span>
  </label>
</div>

<div class="custom-select" id="themeSelect">
  <div class="selected">
    <span>ThÃ¨me</span>
  </div>
  <ul class="options">
    <li data-value="normal"><img src="img/normal.png" alt=""></li>
    <li data-value="feu"><img src="img/feu.png" alt=""></li>
    <li data-value="glace"><img src="img/Glace.png" alt=""></li>
    <li data-value="BW"><img src="img/BW.png" alt=""></li>
  </ul>
</div>

<select id="keySelect" title="Choose click key">
  <option value="Space">Touche: espace</option>
  <option value="Enter">Touche: entrÃ©e</option>
</select>

      <!-- Per-type sound selector + single slider (works before Start) -->
      <div class="sound-controls">
        <select id="soundTypeSelect" title="Type de son">
          <option value="click">Clic</option>
          <option value="crit">Crit</option>
          <option value="achievement">Achievement</option>
          <option value="music">Musique</option>
        </select>
        <input type="range" id="soundVolumeSlider" min="0" max="100" value="85" />
      </div>
  <div class="save-controls">
    <button id="saveNowBtn" style="display:none;">ğŸ’¾ Save</button>
    <button id="statsBtn" style="display:none;">ğŸ“Š Player Stats</button>
    <!-- Stats Popup -->
    <div id="statsPopup" class="stats-popup" style="display:none;">
      <div class="stats-content">
        <h2>ğŸ“Š Your Stats</h2>
        <ul>
          <li>Total Clicks: <span id="statTotalClicks">0</span></li>
          <li>Click Rate (CPS): <span id="statCPS">0</span></li>
          <li>Prestige Count: <span id="statPrestige">0</span></li>
          <li>Best Timed Score: <span id="statBestTimed">0</span></li>
        </ul>
        <button id="closeStats" class="butt">Close</button>
      </div>
    </div>
    <input id="importFile" type="file" accept="application/json" style="display:none;" />
  <button id="bonusButton" style="display:none; position: absolute; right: 20px; top: 10px;">ğŸ</button>
  <span id="bonusTimer" style="margin-left:8px; font-weight:bold; color:#ffd45f; display:none;"></span>
    <button id="backBtn" style="display:none;">ğŸ”™ Back</button>
  </div>
    </div>
  </header>
  <div id="bonusPopup" class="bonus-popup" style="display:none;"></div>
  <!-- Toast container for non-blocking notifications -->
  <div id="toastContainer" style="position:fixed;right:12px;top:12px;z-index:9999;pointer-events:none"></div>

  <!-- Formulaire pseudo -->
  <section id="pseudoForm">
    <label for="pseudo">Entre ton pseudo :</label>
    <input type="text" id="pseudo" placeholder="Ton pseudo" required />
    <button class="butt" id="startBtn">Commencer</button>
  </section>

<!-- Zone de jeu -->
<main id="gameArea" style="display:none;">

  <!-- route des paliers -->
<section id="progressRoute">
<h3 class="route-title">
  <img src="img/PokÃ©_Ball-LPA.png" alt="PokÃ© Ball" class="route-icon">
  Route aux PokÃ© Balls
</h3>  <div id="milestones">
    
    <div class="progress-line">
      <div class="progress-fill"></div>
    </div>
  </div>
</section>

  <!-- HUD -->
  <section class="hud">
    <div id="score">Score : 0</div>
    <div id="stats">
      <span id="multiplierStat">x1</span>
      <span id="autoClickStat">Auto: 0/s</span>
      <span id="critStat">Crit: 10% (x10)</span>
      <span id="prestigeStat">Prestige: 0 (+0%)</span>
    </div>
  </section>

  <!-- colonne gauche : clic + shop -->
  <section class="play">
  <div id="clickZone">
    <div class="cps-indicator">CPS: 0</div>
    <button id="bonusButton" style="display:none;">ğŸ</button>
    <img id="gameImage" src="img/sacha twerk.gif" alt="Image dynamique" />
    <button class="click-btn" id="clicker">Cliquer !</button>
    <div id="pressHint" class="press-hint" style="display:none;">Press Space</div>
    <canvas id="particlesCanvas"></canvas>
  </div>


    <div class="shop">
      <button class="upgrade-btn" id="buyAutoClick">Auto-Click (CoÃ»t : 500â‚½)</button>
      <button class="upgrade-btn" id="buyMultiplier">Multiplicateur (CoÃ»t : 1000â‚½)</button>
      <button class="upgrade-btn" id="buyCritChance">Crit% (CoÃ»t : 2000â‚½)</button>
      <button class="upgrade-btn" id="buyCritPower">Crit x (CoÃ»t : 3000â‚½)</button>
      <button class="upgrade-btn" id="buyTempBoost">Boost 30s (CoÃ»t : 500â‚½)</button>
      <button class="upgrade-btn prestige" id="doPrestige">Prestige (CoÃ»t : 20000â‚½)</button>
    </div>
  </section>

  <!-- colonne droite : chrono / dÃ©fi / succÃ¨s -->
  <aside class="side-panel">
    <section id="modes">
      <div class="mode-timed">
        <h3>â±ï¸ Mode ChronomÃ©trÃ© (60s)</h3>
        <button id="startTimedBtn">DÃ©marrer</button>
        <div id="timedInfo">Temps: 60 | Score: 0 | Meilleur: 0</div>
      </div>

      <div class="daily">
        <h3>ğŸ“… DÃ©fi quotidien</h3>
        <div id="dailyInfo">Objectif du jour: 5000 points. RÃ©compense: +5% pour 10 min.</div>
        <button id="startDailyBtn">Tenter le dÃ©fi</button>
        <div id="dailyStatus">Statut: en attente</div>
      </div>
    </section>

    <section id="events">
      <div id="achievementToast" class="toast" style="display:none;"></div>
    </section>

    <section id="achievements">
      <h2>ğŸ… Achievements</h2>
      <ul id="achievementList"></ul>
    </section>
  </aside>

  <!-- le scoreboard reste en bas Ã  gauche -->
  <section id="scoreboard">
    <h2>ğŸ† Scoreboard</h2>
    <ol id="scoreList"></ol>
  </section>
</main>



  <!-- Audio -->
  <audio id="clickSound" src="song/item-pickup.mp3" preload="auto"></audio>
  <audio id="critSound" src="song/Pokemon (A Button) - Sound Effect (HD).mp3" preload="auto"></audio>
  <audio id="achievementSound" src="song/[Sound Effect] ErasableNinja Low Health (PokÃ©mon low health).mp3" preload="auto"></audio>
  <audio id="music" src="song/Area Zero - PokÃ©mon Scarlet and Violet OST (Gamerip).mp3" preload="auto" loop></audio>

  <!-- Scripts -->
  <script type="module">
  // Import Firebase core and Firestore functions directly from the CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, where, updateDoc } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Your Firebase project configuration (unique to your project)
  const firebaseConfig = {
    apiKey: "AIzaSyAInDN9LtUDLRO-1-vO5Qt_I9Vymh3VZ28",
    authDomain: "pikagirl-43e0a.firebaseapp.com",
    projectId: "pikagirl-43e0a"
  };

  // Initialize Firebase app and Firestore database
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // --- Save score function ---
  // If a pseudo already exists, update its score; otherwise, create a new entry
  async function saveScoreToDB(pseudo, score) {
    try {
      const q = query(collection(db, "scores"), where("pseudo", "==", pseudo));
      const snapshot = await getDocs(q);

      if (!snapshot.empty) {
        // Update existing document
        const docRef = snapshot.docs[0].ref;
        await updateDoc(docRef, { score, timestamp: Date.now() });
        showToast("âœ… Score updated!");
      } else {
        // Create new document
        await addDoc(collection(db, "scores"), { pseudo, score, timestamp: Date.now() });
        showToast("âœ… New score saved!");
      }

      // Refresh the scoreboard after saving
      displayScores();

    } catch (err) {
      console.error("Error saving to DB:", err);
      showToast("âš ï¸ Error while saving online.");
    }
  }

  // --- Display scores function ---
  // Fetch all scores, sort them, keep top 10, and render them in the scoreboard
  async function displayScores() {
    try {
      const snapshot = await getDocs(collection(db, "scores"));
      let scores = snapshot.docs.map(doc => doc.data());

      scores.sort((a, b) => b.score - a.score); // sort descending
      scores = scores.slice(0, 10); // keep top 10

      el.scoreList.innerHTML = "";
      scores.forEach(s => {
        const li = document.createElement("li");
        li.textContent = `${s.pseudo}: ${s.score}`;
        el.scoreList.appendChild(li);
      });
    } catch (err) {
      console.error("Error loading scores:", err);
    }
  }

  // Expose functions globally so script.js can call them
  window.saveScoreToDB = saveScoreToDB;
  window.displayScores = displayScores;
  </script>

  <!-- game script  -->
  <script src="script.js"></script>

</body>
</html>